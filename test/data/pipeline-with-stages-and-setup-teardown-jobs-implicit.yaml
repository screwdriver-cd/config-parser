stages:
    canary:
        requires: baz
        description: For canary deployment
        jobs: [main, publish, docker-publish]

shared:
    image: node:4
jobs:
    main:
        steps:
            - install: npm install
            - test: npm test
            - publish: npm publish
        requires: []
    publish:
        steps:
            - echo-hello: echo hello
        requires: [ main ]
    docker-publish:
        steps:
            - echo-docker: echo docker
        requires: publish
    baz:
        requires: ~commit
        steps:
            - echo-world: echo world
    triggered-after-stage:
        requires: [~stage@canary]
        steps:
            - echo-stage-downstream: echo stage downstream